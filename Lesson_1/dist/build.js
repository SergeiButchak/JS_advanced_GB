(()=>{"use strict";Vue.component("goods-list",{props:["goods","basket"],template:'\n    <div class="goods-list">\n      <goods-item v-for="good in goods" :good="good"  :basket="basket" v-bind:key="good.id">\n      {{good}}\n</goods-item>\n    </div>\n  '}),Vue.component("goods-item",{props:["good","basket"],template:'\n    <div class="goods-item">\n      <h3>{{ good.product_name }}</h3>\n      <p>{{ good.price }}</p>\n      <button v-on:click="basket.addGood(good, 1)">Добавить в корзину</button>\n    </div>\n  '}),Vue.component("basket-list",{props:["goods"],template:'\n    <div class="basket-list">\n      <basket-item v-for="good in goods.goods" :good="good" :basket="goods" v-bind:key="good.id"></basket-item>\n    </div>\n  '}),Vue.component("basket-item",{props:["good","basket"],template:'\n    <div class="basket-item">\n      <h3>{{ good.goodsItem.product_name }}</h3>\n      <p>Количество: {{good.count}}</p>\n      <p>Всего: {{good.total()}}</p>\n      <button v-on:click="basket.removeGood(good.goodsItem.product_name)">Удалить из корзину</button>\n    </div>\n  '}),Vue.component("search-input",{props:["goods"],data:()=>({searchLine:""}),template:'\n        <span class="search">\n            <input class="search-input" type="text" v-model="searchLine">\n            <button class="search-button" @click="clickSearch">Искать</button>\n        </span>\n    ',methods:{clickSearch(){const o=this.searchLine;this.goods.filterGoods(o)}}});const o="http://localhost:3000";function t(o,t){return new Promise(((t,e)=>{let s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");s.open("GET",o,!0),s.send(),s.onload=()=>{200==+s.status?t(JSON.parse(s.responseText)):e(s.statusText)}}))}function e(o,t,e){return new Promise(((e,s)=>{let n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("POST",o,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(t),n.onload=()=>{200==+n.status?e(JSON.parse(n.responseText)):s(n.statusText)}}))}class s{constructor(o,t){this.product_name=o,this.price=t}}class n{constructor(o,t){this.goodsItem=o,this.count=t}addCount(o){this.count+=o}removeCount(o){this.count>o?this.count-=o:this.count=0}total(){return this.goodsItem.price*this.count}}const d=new class{constructor(){this.goods=[],this.filteredGoods=this.goods}filterGoods(o){const t=new RegExp(o,"i");this.filteredGoods=this.goods.filter((o=>t.test(o.product_name)))}fetchGoods(e){t(`${o}/catalogData`).then((o=>{this.goods=o,this.filteredGoods=o}),(o=>{console.log(o)}))}totalSum(){let o=0;for(let t=0;t<this.goods.length;t++)o+=this.goods[t].price;return o}},i=new class{constructor(){this.goods=[]}getBasket(){t(`${o}/cartData`).then((o=>{let t=o;console.log(t),t.forEach((o=>{this.goods.push(new n(new s(o.product_name,o.price),o.quantity))}))}),(o=>{console.log(o)}))}addGood(t,d){e(`${o}/additem`,`{"product_name": "${t.product_name}", "price": ${t.price}, "quantity": ${d}}`).then((o=>{console.log("TODO addGood");let t=o;console.log(t),this.goods=[],t.forEach((o=>{this.goods.push(new n(new s(o.product_name,o.price),o.quantity))}))}),(o=>{console.log(o)}))}removeGood(t){e(`${o}/deleteitem`,`{"product_name": "${t}"}`).then((o=>{console.log("TODO addGood");let t=o;console.log(t),this.goods=[],t.forEach((o=>{this.goods.push(new n(new s(o.product_name,o.price),o.quantity))}))}),(o=>{console.log(o)}))}totalCount(){let o=0;for(let t=0;t<this.goods.length;t++)o+=this.goods[t].count;return o}totalSum(){let o=0;for(let t=0;t<this.goods.length;t++)o+=this.goods[t].total();return o}},c=new Vue({el:"#mainApp",data:{goods:d,basket:i,isVisibleCart:!1},methods:{clickBasket(){this.isVisibleCart=!this.isVisibleCart}},mounted(){this.goods.fetchGoods(),this.basket.getBasket()}});console.log(c)})();